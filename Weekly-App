//App Return//

SELECT currency, 
count(distinct email) as return_customers,
avg(nitems) as item_per_basket,
count(distinct order_number) as orders,
sum(subtotal)/count(distinct order_number) as AOV, 
sum(subtotal) as Revenue

FROM `transactions` 
WHERE postdate between "2017-07-03" and "2017-07-09" 
and email in 
(select email from transactions where postdate<"2017-07-03") 
and store_id like 'dss'
group by currency 


//App New//

SELECT currency, 
count(distinct email) as return_customers,
avg(nitems) as item_per_basket,
count(distinct order_number) as orders,
sum(subtotal)/count(distinct order_number) as AOV, 
sum(subtotal) as Revenue
FROM `transactions` 
WHERE postdate between "2016-07-04" and "2016-07-10" 
and email not in 
(select email from transactions where postdate<"2016-07-04") 
and store_id like 'dss'
group by currency 
